<!DOCTYPE html>
<html>
<head>
	<title>Workouts</title>
	<script src="http://code.jquery.com/jquery-2.0.3.min.js" type="text/javascript"></script>
	<style type="text/css">
		div.workout {
			margin: 1em; padding: 1em;
			border: 1px solid black;
			background-color: #eef;
			overflow: auto;
		}

		div.wData { float: left; width: 25em; margin-right: 2em; }
		div.wData div { margin-top: 0.5em; }
		.wDate { font-size: 150%; }
		div.exercises { float: left; }
		div.exercise { margin-top: 0.5em; }
		span.set { display: inline-block; margin-right: 2em; }
	</style>
</head>
<body>
	<div id="workouts">
	</div>
	<script type="text/javascript">
		var appendWorkout = function(container, workout) {
			var wDiv = $('<div class="workout"></div>');
			var wData = $('<div class="wData"/>');
			var wDate = $('<div class="wDate">' + new Date(workout.start['$date']).toDateString() + '</div>');
			var wMood = $('<div class="wMood">' + workout.mood + '</div>');
			var wComments = $('<div class="wComments">' + workout.comments + '</div>');

			var esDiv = $('<div class="exercises"></div>');
			$.each(workout.exercises, function(index, exercise) {
					var eDiv = $('<div class="exercise"></div>');
					var nameDiv = $('<div class="eName">' + exercise.name + '</div>');
					eDiv.append(nameDiv);
					esDiv.append(eDiv);
					$.each(exercise.sets, function(index, set) {
						var setSpan = $('<span class="set">' + set.reps + 'x' + set.weight + '</span>');
						if (set.set)
							setSpan.text(setSpan.text() + '+' + set.set.reps +'x' + set.set.weight + ' ');
						else
							setSpan.text(setSpan.text() + ' ');
						if (set.comment)
							setSpan.append($('<span class="sComment">(' + set.comment + ')</span>'));
						eDiv.append(setSpan);
					});
			});

			wData.append(wDate).append(wMood).append(wComments);
			wDiv.append(wData).append(esDiv);
			container.append(wDiv);
		};

		$(function() {
				$.getJSON("/lift/workouts/find", function(data) {
					var workoutsCont = $('#workouts');
					workoutsCont.empty();
					$.each(data.rows.reverse(), function(index, workout) {
						appendWorkout(workoutsCont, workout);
					});
				});
		});
	</script>
</body>
</html>
